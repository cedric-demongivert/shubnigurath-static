{"version":3,"file":"static/webpack/static\\development\\pages\\index.js.a282ad958b0e837c0cd4.hot-update.js","sources":["webpack:///./components/page/loading/LoadingPage.tsx"],"sourcesContent":["import React from 'react'\r\nimport { \r\n  tokenize, \r\n  parse,\r\n  UnidocEvent, \r\n  UnidocProducer, \r\n  UnidocProducerEvent, \r\n  UnidocReducer, \r\n  UnidocValidationEvent,\r\n  UnidocValidator \r\n} from '@cedric-demongivert/unidoc'\r\n\r\nimport { UnidocCommand } from '../../../typescript/unidoc/UnidocCommand'\r\nimport { InvestigatorCommand } from '../../../typescript/unidoc/InvestigatorCommand'\r\nimport { Investigator } from '../../../typescript/Investigator'\r\nimport { UnidocFileSymbolProducer } from '../../../typescript/unidoc/UnidocFileSymbolProducer'\r\nimport { Empty } from '../../../typescript/utils'\r\n\r\nimport { InitialState } from './InitialState'\r\nimport { LoadingState } from './LoadingState'\r\nimport { ResolvedState } from './ResolvedState'\r\nimport { LoadingPageState } from './LoadingPageState'\r\n\r\n/**\r\n * \r\n */\r\nexport class LoadingPage extends React.Component<LoadingPage.Properties, LoadingPage.State> {\r\n  /**\r\n   * \r\n   */\r\n  public static readonly defaultProps: Readonly<LoadingPage.Properties> = {\r\n    /**\r\n     * \r\n     */\r\n    onLoad: Empty.callback\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public constructor (properties: LoadingPage.Properties) {\r\n    super(properties)\r\n\r\n    this.handleFileSelection = this.handleFileSelection.bind(this)\r\n    this.handleFileValidation = this.handleFileValidation.bind(this)\r\n    this.handleFileReduction = this.handleFileReduction.bind(this)\r\n\r\n    this.state = {\r\n      state: LoadingPageState.INITIAL,\r\n      file: undefined,\r\n      source: undefined,\r\n      error: undefined\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private handleFileValidation (validation: UnidocValidationEvent) : void {\r\n    // @TODO error-check\r\n    //console.log(validation.toString())\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private handleFileReduction (value: Investigator) : void {\r\n    this.setState({ \r\n      state: LoadingPageState.RESOLVED\r\n    })\r\n\r\n    this.props.onLoad(value)\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  private handleFileSelection(file: File): void {\r\n    const source: UnidocFileSymbolProducer = UnidocFileSymbolProducer.create(file)\r\n    const events: UnidocProducer<UnidocEvent> = parse(tokenize(source))\r\n    const validator: UnidocValidator = UnidocValidator.kiss(UnidocCommand.validateUnidoc.factory(InvestigatorCommand.validate))\r\n\r\n    validator.subscribe(events)\r\n\r\n    const reducer: UnidocProducer<Investigator> = UnidocReducer.reduce.validation(validator, UnidocCommand.reduce.factory(InvestigatorCommand.reduce))\r\n\r\n    validator.addEventListener(UnidocProducerEvent.PRODUCTION, this.handleFileValidation)\r\n    reducer.addEventListener(UnidocProducerEvent.PRODUCTION, this.handleFileReduction)\r\n\r\n    this.setState({ \r\n      state: LoadingPageState.LOADING,\r\n      file,\r\n      source,\r\n      error: undefined\r\n    }, source.read.bind(source))\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public render () : React.ReactElement {\r\n    switch (this.state.state) {\r\n      case LoadingPageState.INITIAL:\r\n        return this.renderInitialState()\r\n      case LoadingPageState.LOADING:\r\n        return this.renderLoadingState()\r\n        case LoadingPageState.RESOLVED:\r\n          return this.renderResolvedState()\r\n      default:\r\n        throw new Error(\r\n          'Unable to render loading page in state ' + LoadingPageState.toDebugString(this.state.state) + \r\n          ' because no rendering factory was defined for that.'\r\n        )\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public renderInitialState (): React.ReactElement {\r\n    return <InitialState \r\n      cancellable={this.props.cancellable} \r\n      onCancel={this.props.onCancel} \r\n      className={this.props.className} \r\n      onSelection={this.handleFileSelection} \r\n    />\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public renderLoadingState (): React.ReactElement {\r\n    return <LoadingState className={this.props.className} file={this.state.file} />\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  public renderResolvedState (): React.ReactElement {\r\n    return <ResolvedState className={this.props.className} />\r\n  }\r\n}\r\n\r\n/**\r\n * \r\n */\r\nexport namespace LoadingPage {\r\n  /**\r\n   * \r\n   */\r\n  export type LoadCallback = (result: Investigator) => void\r\n\r\n  /**\r\n   * \r\n   */\r\n  export type Properties = {\r\n    /**\r\n     * \r\n     */\r\n    className?: string | undefined,\r\n\r\n    /**\r\n     * \r\n     */\r\n    cancellable?: boolean | undefined,\r\n\r\n    /**\r\n     * \r\n     */\r\n    onLoad?: LoadCallback | undefined,\r\n\r\n\r\n    /**\r\n     * \r\n     */\r\n     onCancel?: () => void | undefined\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  export type InitialState = {\r\n    /**\r\n     * \r\n     */\r\n    state: LoadingPageState.INITIAL,\r\n\r\n    /**\r\n     * \r\n     */\r\n    file: undefined,\r\n\r\n    /**\r\n     * \r\n     */\r\n    source: undefined,\r\n\r\n    /**\r\n     * \r\n     */\r\n    error: undefined\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  export type LoadingState = {\r\n    /**\r\n     * \r\n     */\r\n    state: LoadingPageState.LOADING,\r\n\r\n    /**\r\n     * \r\n     */\r\n    file: File,\r\n\r\n    /**\r\n     * \r\n     */\r\n    source: UnidocFileSymbolProducer,\r\n\r\n    /**\r\n     * \r\n     */\r\n    error: undefined\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  export type FailureState = {\r\n    /**\r\n     * \r\n     */\r\n    state: LoadingPageState.FAILURE,\r\n\r\n    /**\r\n     * \r\n     */\r\n    file: File,\r\n\r\n    /**\r\n     * \r\n     */\r\n    source: UnidocFileSymbolProducer,\r\n\r\n    /**\r\n     * \r\n     */\r\n    error: Error\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  export type ResolvedState = {\r\n    /**\r\n     * \r\n     */\r\n    state: LoadingPageState.RESOLVED,\r\n\r\n    /**\r\n     * \r\n     */\r\n    file: File,\r\n\r\n    /**\r\n     * \r\n     */\r\n    source: UnidocFileSymbolProducer,\r\n\r\n    /**\r\n     * \r\n     */\r\n    error: undefined\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  export type State = InitialState | LoadingState | FailureState | ResolvedState\r\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AAWA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AAOA;AACA;AACA;AACA;AAAA;AACA;AADA;AACA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAPA;AAaA;AAEA;AACA;AACA;AACA;AACA;AAjCA;AAAA;AAAA;AAkCA;AACA;AAEA;AACA;AACA;AACA;AAxCA;AAAA;AAAA;AAyCA;AACA;AADA;AAIA;AACA;AAEA;AACA;AACA;AACA;AAnDA;AAAA;AAAA;AAoDA;AACA;AACA;AAEA;AAEA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAEA;AACA;AACA;AACA;AA1EA;AAAA;AAAA;AA2EA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AARA;AAaA;AAEA;AACA;AACA;AACA;AA7FA;AAAA;AAAA;AA8FA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAEA;AACA;AACA;AACA;AAzGA;AAAA;AAAA;AA0GA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAhHA;AAAA;AAAA;AAiHA;AAAA;AAAA;AACA;AAlHA;AACA;AADA;AAAA;AAqHA;AACA;AACA;AACA;AAxHA;AAKA;AACA;AACA;AACA;AAJA;AACA;AAmHA;;;;A","sourceRoot":""}